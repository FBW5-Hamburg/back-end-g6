<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta http-equiv="X-UA-Compatible" content="ie=edge" />
		<!-- Font Awesome -->
		<link
			rel="stylesheet"
			href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css"
			integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk="
			crossorigin="anonymous"
		/>
		<!-- CSS -->
		<link rel="stylesheet" href="css/style.css" />
		<title>ChatApp</title>
	</head>
	<body>
		<div class="join-container">
			<header class="join-header">
				<!-- <h1><i class="fas fa-smile"></i> ChatApp</h1> -->
				<h1>ChatApp</h1>
			</header>
			<main class="join-main">
				<form method="POST" action="/">
					<div class="form-control">
						<label for="firstname">Firstname</label>
						<input type="text" name="firstname" id="firstname" placeholder="Enter Firstname" required />
						<label for="lastname">Lastname</label>
						<input type="text" name="lastname" id="lastname" placeholder="Enter Lastname" required />
						<label for="username">Username</label>
						<input type="text" name="username" id="username" placeholder="Enter Username" required />
						<label for="email">Email</label>
						<input type="email" name="email" id="email" placeholder="Enter Email" required />
						<label for="password">Password</label>
						<input type="password" name="password" id="password" placeholder="Enter Password" required />
						<label for="repassword">Confirmation</label>
						<input type="password" name="repassword" id="repassword" placeholder="Confirm Password" required />
					</div>
					<button type="submit" class="btn">Join Chat</button>
				</form>
			</main>
		</div>
		<script>
			document.querySelector('.btn').addEventListener('click', e => {
				e.preventDefault()
				// input data
				const firstName = document.querySelector('#firstname');
				const lastName = document.querySelector('#lastname');
				const userName = document.querySelector('#username');
				const email = document.querySelector('#email');
				const password = document.querySelector('#password');
				const repassword = document.querySelector('#repassword');

				if(firstName.value.trim() && lastName.value.trim() && userName.value.trim() && email.value.trim() && password.value && repassword.value) {
					if(password.value === repassword.value) {
						// user object with input data
						const USER = {
							firstname: firstName.value.trim(),
							lastname: lastName.value.trim(),
							username: userName.value.trim(),
							email: email.value.trim(),
							password: password.value
						}
						// request
						fetch('/', {
							method: 'POST',
							headers: {
								'Content-Type': 'application/json'
							},
							body: JSON.stringify(USER)
						}).then(response => {
							if(response.status === 200) {
								response.json().then(data => {
									if (data === 1) {
										window.location = "/chat";
									}
								}).catch(err => {
									console.log(err.message);
								})
							} else {
								console.log("Can not connect to the server");
							}
						}).catch(err => {
							console.log(err.message);
						});
					} else {
						console.log("Passwords do not match");
					}
				} else {
					console.log("Not all inputs are filled");
				}
			});
		</script>
	</body>
</html>
